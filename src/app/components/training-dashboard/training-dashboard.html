<div style="min-height: 100vh; background: #0a0e27; padding: 1.5rem">
  <!-- Header -->
  <div style="margin-bottom: 2rem">
    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem">
      <span style="font-size: 2.5rem; color: #10b981">
        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"></path>
          <path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z">
          </path>
          <path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"></path>
          <path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"></path>
        </svg>
      </span>
      <h1 style="
          font-size: 2.5rem;
          font-weight: 700;
          background: linear-gradient(to right, #10b981, #06b6d4);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
        ">
        Training Dashboard
      </h1>
    </div>
    <p style="font-size: 1.125rem; color: #9ca3af">
      Train your model and monitor progress in real-time
    </p>
  </div>

  <!-- Training Controls -->
  <div style="
      margin-bottom: 1.5rem;
      background: rgba(26, 31, 46, 0.8);
      border-radius: 16px;
      padding: 1.5rem;
      border: 2px solid rgba(45, 53, 72, 0.6);
      backdrop-filter: blur(20px);
    ">
    <h2 style="font-size: 1.5rem; font-weight: 700; color: #06b6d4; margin-bottom: 1rem">
      Training Configuration
    </h2>

    <div style="
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
      ">
      <div>
        <label style="display: block; font-size: 0.875rem; color: #9ca3af; margin-bottom: 0.5rem">Epochs</label>
        <input [(ngModel)]="epochs" type="number" min="1" [disabled]="isTraining()"
          [style.opacity]="isTraining() ? '0.5' : '1'" style="
            width: 100%;
            background: rgba(15, 20, 25, 0.8);
            border: 2px solid #2d3548;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: white;
            transition: all 0.2s;
          " onfocus="if(!this.disabled) this.style.borderColor='#06b6d4'" onblur="this.style.borderColor='#2d3548'" />
      </div>
      <div>
        <label style="display: block; font-size: 0.875rem; color: #9ca3af; margin-bottom: 0.5rem">Batch Size</label>
        <input [(ngModel)]="batchSize" type="number" min="1" [disabled]="isTraining()"
          [style.opacity]="isTraining() ? '0.5' : '1'" style="
            width: 100%;
            background: rgba(15, 20, 25, 0.8);
            border: 2px solid #2d3548;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: white;
            transition: all 0.2s;
          " onfocus="if(!this.disabled) this.style.borderColor='#06b6d4'" onblur="this.style.borderColor='#2d3548'" />
      </div>
      <div>
        <label style="display: block; font-size: 0.875rem; color: #9ca3af; margin-bottom: 0.5rem">Validation
          Split</label>
        <input [(ngModel)]="validationSplit" type="number" step="0.1" min="0" max="0.5" [disabled]="isTraining()"
          [style.opacity]="isTraining() ? '0.5' : '1'" style="
            width: 100%;
            background: rgba(15, 20, 25, 0.8);
            border: 2px solid #2d3548;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: white;
            transition: all 0.2s;
          " onfocus="if(!this.disabled) this.style.borderColor='#06b6d4'" onblur="this.style.borderColor='#2d3548'" />
      </div>
    </div>

    <div style="display: flex; gap: 0.75rem">
      @if (!isTraining()) {
      <button (click)="startTraining()" style="
          flex: 1;
          padding: 1rem 1.5rem;
          background: linear-gradient(to right, #10b981, #06b6d4);
          color: white;
          border-radius: 12px;
          font-weight: 700;
          transition: all 0.3s;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 0.5rem;
        "
        onmouseover="this.style.transform='scale(1.02)'; this.style.boxShadow='0 20px 25px -5px rgba(16, 185, 129, 0.5)'"
        onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="5 3 19 12 5 21 5 3"></polygon>
        </svg>
        Start Training
      </button>
      } @else {
      <button (click)="pauseTraining()" style="
          flex: 1;
          padding: 1rem 1.5rem;
          background: rgba(251, 146, 60, 0.2);
          color: #fb923c;
          border-radius: 12px;
          font-weight: 700;
          transition: all 0.3s;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 0.5rem;
        " onmouseover="this.style.background='rgba(251, 146, 60, 0.3)'"
        onmouseout="this.style.background='rgba(251, 146, 60, 0.2)'">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="6" y="4" width="4" height="16"></rect>
          <rect x="14" y="4" width="4" height="16"></rect>
        </svg>
        Pause
      </button>
      <button (click)="stopTraining()" style="
          flex: 1;
          padding: 1rem 1.5rem;
          background: rgba(239, 68, 68, 0.2);
          color: #ef4444;
          border-radius: 12px;
          font-weight: 700;
          transition: all 0.3s;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 0.5rem;
        " onmouseover="this.style.background='rgba(239, 68, 68, 0.3)'"
        onmouseout="this.style.background='rgba(239, 68, 68, 0.2)'">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
        </svg>
        Stop
      </button>
      }
    </div>
  </div>

  <!-- Progress Bar -->
  @if (isTraining() && currentProgress()) {
  <div style="
      margin-bottom: 1.5rem;
      background: rgba(26, 31, 46, 0.8);
      border-radius: 16px;
      padding: 1.5rem;
      border: 2px solid rgba(45, 53, 72, 0.6);
      backdrop-filter: blur(20px);
    ">
    <div style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
      ">
      <span style="color: #06b6d4; font-weight: 600">
        Epoch {{ currentProgress()!.currentEpoch + 1 }} / {{ currentProgress()!.totalEpochs }}
      </span>
      <span style="color: #9ca3af"> ETA: {{ getEtaString() }} </span>
    </div>

    <div style="
        width: 100%;
        background: rgba(15, 20, 25, 0.8);
        border-radius: 9999px;
        height: 1rem;
        overflow: hidden;
      ">
      <div style="
          height: 100%;
          background: linear-gradient(to right, #10b981, #06b6d4);
          transition: width 0.3s;
        " [style.width.%]="getProgressPercentage()"></div>
    </div>

    <div style="margin-top: 0.75rem; font-size: 0.875rem; color: #9ca3af">
      Batch {{ currentProgress()!.currentBatch }} / {{ currentProgress()!.totalBatches }}
    </div>
  </div>
  }

  <!-- Current Metrics -->
  @if (currentMetrics()) {
  <div style="
      margin-bottom: 1.5rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    ">
    <div style="
        background: rgba(26, 31, 46, 0.8);
        border-radius: 12px;
        padding: 1rem;
        border: 2px solid rgba(45, 53, 72, 0.6);
        backdrop-filter: blur(20px);
      ">
      <div style="font-size: 0.875rem; color: #9ca3af; margin-bottom: 0.25rem">Loss</div>
      <div style="font-size: 1.5rem; font-weight: 700; color: #06b6d4">
        {{ currentMetrics()!.loss | numberFormat : 4 }}
      </div>
    </div>

    <div style="
        background: rgba(26, 31, 46, 0.8);
        border-radius: 12px;
        padding: 1rem;
        border: 2px solid rgba(45, 53, 72, 0.6);
        backdrop-filter: blur(20px);
      ">
      <div style="font-size: 0.875rem; color: #9ca3af; margin-bottom: 0.25rem">Accuracy</div>
      <div style="font-size: 1.5rem; font-weight: 700; color: #10b981">
        {{ currentMetrics()!.accuracy | percentage : 2 }}
      </div>
    </div>

    @if (currentMetrics()!.valLoss !== undefined) {
    <div style="
        background: rgba(26, 31, 46, 0.8);
        border-radius: 12px;
        padding: 1rem;
        border: 2px solid rgba(45, 53, 72, 0.6);
        backdrop-filter: blur(20px);
      ">
      <div style="font-size: 0.875rem; color: #9ca3af; margin-bottom: 0.25rem">Val Loss</div>
      <div style="font-size: 1.5rem; font-weight: 700; color: #d946ef">
        {{ currentMetrics()!.valLoss | numberFormat : 4 }}
      </div>
    </div>
    } @if (currentMetrics()!.valAccuracy !== undefined) {
    <div style="
        background: rgba(26, 31, 46, 0.8);
        border-radius: 12px;
        padding: 1rem;
        border: 2px solid rgba(45, 53, 72, 0.6);
        backdrop-filter: blur(20px);
      ">
      <div style="font-size: 0.875rem; color: #9ca3af; margin-bottom: 0.25rem">Val Accuracy</div>
      <div style="font-size: 1.5rem; font-weight: 700; color: #fb923c">
        {{ currentMetrics()!.valAccuracy | percentage : 2 }}
      </div>
    </div>
    }
  </div>
  }

  <!-- Charts -->
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem">
    <!-- Loss Chart -->
    <div style="
        background: rgba(26, 31, 46, 0.8);
        border-radius: 16px;
        padding: 1.5rem;
        border: 2px solid rgba(45, 53, 72, 0.6);
        backdrop-filter: blur(20px);
      ">
      <canvas #lossChart style="width: 100%" height="300"></canvas>
    </div>

    <!-- Accuracy Chart -->
    <div style="
        background: rgba(26, 31, 46, 0.8);
        border-radius: 16px;
        padding: 1.5rem;
        border: 2px solid rgba(45, 53, 72, 0.6);
        backdrop-filter: blur(20px);
      ">
      <canvas #accuracyChart style="width: 100%" height="300"></canvas>
    </div>
  </div>

  <!-- Training Tips -->
  <div style="
      margin-top: 1.5rem;
      background: rgba(26, 31, 46, 0.8);
      border-radius: 16px;
      padding: 1.5rem;
      border: 2px solid rgba(6, 182, 212, 0.3);
      backdrop-filter: blur(20px);
    ">
    <h3 style="
        font-size: 1.125rem;
        font-weight: 600;
        color: #06b6d4;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
      ">
      <span style="margin-right: 0.5rem">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 18h6"></path>
          <path d="M10 22h4"></path>
          <path
            d="M15.09 14c.18-.9.27-1.48.27-2.03A5.5 5.5 0 0 0 9.86 6.5a5.5 5.5 0 0 0-5.36 5.47c0 .55.09 1.13.27 2.03.37 1.86 1.93 3.25 3.83 3.25h2.67c1.9 0 3.46-1.39 3.83-3.25z">
          </path>
        </svg>
      </span>
      Training Tips
    </h3>
    <ul style="
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        font-size: 0.875rem;
        color: #9ca3af;
      ">
      <li>
        â€¢ <span style="color: #10b981">Start with fewer epochs</span> to test your architecture
        quickly
      </li>
      <li>â€¢ <span style="color: #10b981">Increase batch size</span> if you have memory issues</li>
      <li>â€¢ <span style="color: #10b981">Use early stopping</span> to prevent overfitting</li>
      <li>
        â€¢ <span style="color: #10b981">Monitor validation metrics</span> to detect overfitting early
      </li>
    </ul>
  </div>

  <!-- Validation Metrics -->
  @if (confusionMatrix(); as matrix) {
  <div style="
      margin-top: 1.5rem;
      background: rgba(26, 31, 46, 0.8);
      border-radius: 16px;
      padding: 1.5rem;
      border: 2px solid rgba(139, 92, 246, 0.3);
      backdrop-filter: blur(20px);
    ">
    <h3 style="
        font-size: 1.125rem;
        font-weight: 600;
        color: #a78bfa;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      ">
      <span>ðŸŽ¯</span> Validation Metrics (Test Set)
    </h3>

    <!-- Summary Cards -->
    <div style="
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
      ">
      <div style="
          background: rgba(15, 20, 25, 0.6);
          padding: 1rem;
          border-radius: 12px;
          border: 1px solid rgba(139, 92, 246, 0.2);
        ">
        <div style="color: #9ca3af; font-size: 0.875rem; margin-bottom: 0.25rem">Avg Precision</div>
        <div style="color: #a78bfa; font-size: 1.5rem; font-weight: 700">
          {{ getAverageMetric(matrix.precision) | percentage: 2 }}
        </div>
      </div>
      <div style="
          background: rgba(15, 20, 25, 0.6);
          padding: 1rem;
          border-radius: 12px;
          border: 1px solid rgba(139, 92, 246, 0.2);
        ">
        <div style="color: #9ca3af; font-size: 0.875rem; margin-bottom: 0.25rem">Avg Recall</div>
        <div style="color: #a78bfa; font-size: 1.5rem; font-weight: 700">
          {{ getAverageMetric(matrix.recall) | percentage: 2 }}
        </div>
      </div>
      <div style="
          background: rgba(15, 20, 25, 0.6);
          padding: 1rem;
          border-radius: 12px;
          border: 1px solid rgba(139, 92, 246, 0.2);
        ">
        <div style="color: #9ca3af; font-size: 0.875rem; margin-bottom: 0.25rem">Avg F1 Score</div>
        <div style="color: #a78bfa; font-size: 1.5rem; font-weight: 700">
          {{ getAverageMetric(matrix.f1Score) | percentage: 2 }}
        </div>
      </div>
    </div>

    <!-- Per-Class Metrics Table -->
    <div style="overflow-x: auto; margin-bottom: 2rem">
      <table style="width: 100%; border-collapse: collapse; color: #d1d5db; font-size: 0.875rem">
        <thead>
          <tr style="border-bottom: 1px solid rgba(75, 85, 99, 0.4)">
            <th style="text-align: left; padding: 0.75rem; color: #9ca3af">Class</th>
            <th style="text-align: right; padding: 0.75rem; color: #9ca3af">Precision</th>
            <th style="text-align: right; padding: 0.75rem; color: #9ca3af">Recall</th>
            <th style="text-align: right; padding: 0.75rem; color: #9ca3af">F1 Score</th>
          </tr>
        </thead>
        <tbody>
          @for (cls of matrix.classes; track cls; let i = $index) {
          <tr style="border-bottom: 1px solid rgba(75, 85, 99, 0.2)">
            <td style="padding: 0.75rem">Class {{ cls }}</td>
            <td style="text-align: right; padding: 0.75rem; color: #a78bfa">
              {{ matrix.precision[i] | percentage: 1 }}
            </td>
            <td style="text-align: right; padding: 0.75rem; color: #a78bfa">
              {{ matrix.recall[i] | percentage: 1 }}
            </td>
            <td style="text-align: right; padding: 0.75rem; color: #a78bfa">
              {{ matrix.f1Score[i] | percentage: 1 }}
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Confusion Matrix Heatmap -->
    <h4 style="color: #9ca3af; font-size: 0.875rem; margin-bottom: 1rem">Confusion Matrix</h4>
    <div style="overflow-x: auto">
      <div [style.display]="'grid'" [style.grid-template-columns]="'auto repeat(' + matrix.classes.length + ', 1fr)'"
        style="gap: 2px; min-width: 300px">
        <!-- Header Row -->
        <div></div>
        @for (cls of matrix.classes; track cls) {
        <div style="text-align: center; padding: 0.5rem; color: #9ca3af; font-size: 0.75rem">
          Pred {{ cls }}
        </div>
        }

        <!-- Rows -->
        @for (row of matrix.matrix; track row; let i = $index) {
        <div style="
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.5rem;
            color: #9ca3af;
            font-size: 0.75rem;
          ">
          True {{ matrix.classes[i] }}
        </div>
        @for (val of row; track val) {
        <div style="
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 600;
            color: white;
          " [style.background]="getHeatmapColor(val, matrix.matrix)">
          {{ val }}
        </div>
        } }
      </div>
    </div>
  </div>
  }

  <!-- Metrics Explanation Footer -->
  <div style="
      margin-top: 1.5rem;
      background: rgba(15, 20, 25, 0.8);
      border-radius: 16px;
      padding: 1.5rem;
      border: 1px solid rgba(45, 53, 72, 0.6);
    ">
    <h3 style="font-size: 1rem; font-weight: 600; color: #d1d5db; margin-bottom: 1rem">
      Understanding Metrics
    </h3>
    <div style="
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
      ">
      <div>
        <div style="color: #ef4444; font-weight: 600; margin-bottom: 0.25rem">Loss</div>
        <p style="font-size: 0.875rem; color: #9ca3af">
          How "wrong" the model is. Lower is better. If it doesn't decrease, the model isn't
          learning.
        </p>
      </div>
      <div>
        <div style="color: #06b6d4; font-weight: 600; margin-bottom: 0.25rem">Accuracy</div>
        <p style="font-size: 0.875rem; color: #9ca3af">
          Percentage of correct predictions. Higher is better. 1.0 means 100% correct.
        </p>
      </div>
      <div>
        <div style="color: #f59e0b; font-weight: 600; margin-bottom: 0.25rem">Val Loss</div>
        <p style="font-size: 0.875rem; color: #9ca3af">
          Loss on unseen data. If this goes up while training loss goes down, you are overfitting.
        </p>
      </div>
      <div>
        <div style="color: #10b981; font-weight: 600; margin-bottom: 0.25rem">Val Accuracy</div>
        <p style="font-size: 0.875rem; color: #9ca3af">
          Accuracy on unseen data. This is the true test of how well your model will perform.
        </p>
      </div>
    </div>
  </div>
</div>