<div style="min-height: calc(100vh - 150px)">
  <!-- Layer Palette - Horizontal -->
  <div style="margin-bottom: 2rem">
    <div
      style="
        background: rgba(26, 31, 46, 0.6);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(45, 53, 72, 0.6);
        border-radius: 16px;
        padding: 1.5rem;
      "
    >
      <h2 style="font-size: 1.25rem; font-weight: 600; color: white; margin-bottom: 1rem">
        Available Layers
      </h2>

      <div
        style="
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
          gap: 1rem;
        "
      >
        @for (template of layerTemplates; track template.type) {
        <div
          appDraggable
          [dragData]="template"
          style="
            padding: 1.25rem;
            border-radius: 12px;
            border: 2px solid #2d3548;
            background: rgba(15, 20, 25, 0.8);
            cursor: grab;
            transition: all 0.2s;
            text-align: center;
          "
          onmouseover="this.style.borderColor='#06b6d4'; this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(6, 182, 212, 0.3)'"
          onmouseout="this.style.borderColor='#2d3548'; this.style.transform='translateY(0)'; this.style.boxShadow='none'"
        >
          <div style="font-size: 2.5rem; margin-bottom: 0.5rem">{{ template.icon }}</div>
          <h3 style="font-weight: 600; color: white; font-size: 0.9375rem; margin-bottom: 0.25rem">
            {{ template.name }}
          </h3>
          <p style="font-size: 0.75rem; color: #9ca3af">{{ template.description }}</p>
        </div>
        }
      </div>
    </div>
  </div>

  <div style="display: grid; grid-template-columns: 1fr 300px; gap: 2rem">
    <!-- Architecture Canvas -->
    <div>
      <div
        style="
          background: rgba(26, 31, 46, 0.6);
          backdrop-filter: blur(20px);
          border: 1px solid rgba(45, 53, 72, 0.6);
          border-radius: 16px;
          padding: 2rem;
        "
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
          "
        >
          <input
            [(ngModel)]="architectureName"
            style="
              background: rgba(15, 20, 25, 0.8);
              border: 2px solid #2d3548;
              border-radius: 12px;
              padding: 0.75rem 1rem;
              color: white;
              font-size: 1.125rem;
              font-weight: 600;
              max-width: 400px;
              flex: 1;
              margin-right: 1rem;
            "
            placeholder="My Neural Network"
          />
          <div style="display: flex; gap: 0.75rem">
            <button
              (click)="clearLayers()"
              style="
                padding: 0.625rem 1.25rem;
                background: rgba(239, 68, 68, 0.1);
                color: #ef4444;
                border: 2px solid rgba(239, 68, 68, 0.3);
                border-radius: 10px;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.2s;
              "
              onmouseover="this.style.background='rgba(239, 68, 68, 0.2)'"
              onmouseout="this.style.background='rgba(239, 68, 68, 0.1)'"
            >
              Clear
            </button>
            <button
              (click)="exportArchitecture()"
              style="
                padding: 0.625rem 1.25rem;
                background: rgba(139, 92, 246, 0.1);
                color: #8b5cf6;
                border: 2px solid rgba(139, 92, 246, 0.3);
                border-radius: 10px;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.2s;
              "
              onmouseover="this.style.background='rgba(139, 92, 246, 0.2)'"
              onmouseout="this.style.background='rgba(139, 92, 246, 0.1)'"
            >
              Export
            </button>
            <label
              style="
                padding: 0.625rem 1.25rem;
                background: rgba(59, 130, 246, 0.1);
                color: #3b82f6;
                border: 2px solid rgba(59, 130, 246, 0.3);
                border-radius: 10px;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.2s;
              "
              onmouseover="this.style.background='rgba(59, 130, 246, 0.2)'"
              onmouseout="this.style.background='rgba(59, 130, 246, 0.1)'"
            >
              Import
              <input
                type="file"
                accept=".json"
                (change)="importArchitecture($event)"
                style="display: none"
              />
            </label>
          </div>
        </div>

        <div
          appDropZone
          (itemDrop)="onLayerDrop($event)"
          style="
            min-height: 400px;
            background: rgba(15, 20, 25, 0.5);
            border-radius: 16px;
            border: 2px dashed #2d3548;
            padding: 1.5rem;
          "
          class="drop-zone"
        >
          @if (layers().length === 0) {
          <div
            style="
              display: flex;
              align-items: center;
              justify-content: center;
              height: 100%;
              min-height: 350px;
            "
          >
            <div style="text-align: center">
              <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5">‚¨áÔ∏è</div>
              <p style="font-size: 1.125rem; color: #9ca3af">
                Drop layers here to build your network
              </p>
            </div>
          </div>
          } @else {
          <div style="display: flex; flex-direction: column; gap: 1rem">
            @for (layer of layers(); track layer.id; let idx = $index) {
            <div
              (click)="selectLayer(idx)"
              [style.border-color]="selectedLayerIndex() === idx ? '#06b6d4' : '#2d3548'"
              [style.background]="
                selectedLayerIndex() === idx ? 'rgba(6, 182, 212, 0.1)' : 'rgba(26, 31, 46, 0.6)'
              "
              [style.box-shadow]="
                selectedLayerIndex() === idx ? '0 0 0 3px rgba(6, 182, 212, 0.2)' : 'none'
              "
              style="
                padding: 1.25rem;
                padding-left: 3.5rem;
                border-radius: 12px;
                border: 2px solid;
                backdrop-filter: blur(20px);
                transition: all 0.2s;
                cursor: pointer;
                position: relative;
              "
              onmouseover="if(!this.style.boxShadow.includes('rgba(6, 182, 212, 0.2)')) this.style.borderColor='#06b6d4'"
              onmouseout="if(!this.style.boxShadow.includes('rgba(6, 182, 212, 0.2)')) this.style.borderColor='#2d3548'"
            >
              <div
                [style]="{
                  position: 'absolute',
                  left: '0.75rem',
                  top: '50%',
                  transform: 'translateY(-50%)',
                  width: '32px',
                  height: '32px',
                  'border-radius': '8px',
                  background: 'linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%)',
                  display: 'flex',
                  'align-items': 'center',
                  'justify-content': 'center',
                  color: 'white',
                  'font-weight': '700',
                  'font-size': '0.875rem'
                }"
              >
                {{ idx + 1 }}
              </div>
              <div style="display: flex; align-items: center; justify-content: space-between">
                <div style="display: flex; align-items: center; gap: 1rem; flex: 1">
                  <div style="font-size: 2rem">{{ getLayerIcon(layer) }}</div>
                  <div>
                    <h3
                      style="
                        font-weight: 600;
                        color: white;
                        font-size: 1rem;
                        margin-bottom: 0.25rem;
                      "
                    >
                      {{ layer.name }}
                    </h3>
                    <p style="font-size: 0.875rem; color: #9ca3af">
                      {{ getLayerDisplayInfo(layer) }}
                    </p>
                    @if (idx === 0 && layer.inputShape) {
                    <p style="font-size: 0.75rem; color: #10b981; margin-top: 0.25rem">
                      ‚úì Input: [{{ layer.inputShape.join(', ') }}]
                    </p>
                    }
                  </div>
                </div>
                <div style="display: flex; gap: 0.5rem">
                  <button
                    (click)="moveLayerUp(idx); $event.stopPropagation()"
                    [disabled]="idx === 0"
                    style="
                      padding: 0.5rem 0.75rem;
                      background: rgba(15, 20, 25, 0.8);
                      border-radius: 8px;
                      cursor: pointer;
                      font-size: 1.125rem;
                      color: white;
                      border: 1px solid #2d3548;
                      transition: all 0.2s;
                    "
                    [style.opacity]="idx === 0 ? '0.3' : '1'"
                    [style.cursor]="idx === 0 ? 'not-allowed' : 'pointer'"
                    onmouseover="if(!this.disabled) this.style.background='rgba(6, 182, 212, 0.2)'"
                    onmouseout="this.style.background='rgba(15, 20, 25, 0.8)'"
                  >
                    ‚Üë
                  </button>
                  <button
                    (click)="moveLayerDown(idx); $event.stopPropagation()"
                    [disabled]="idx === layers().length - 1"
                    style="
                      padding: 0.5rem 0.75rem;
                      background: rgba(15, 20, 25, 0.8);
                      border-radius: 8px;
                      cursor: pointer;
                      font-size: 1.125rem;
                      color: white;
                      border: 1px solid #2d3548;
                      transition: all 0.2s;
                    "
                    [style.opacity]="idx === layers().length - 1 ? '0.3' : '1'"
                    [style.cursor]="idx === layers().length - 1 ? 'not-allowed' : 'pointer'"
                    onmouseover="if(!this.disabled) this.style.background='rgba(6, 182, 212, 0.2)'"
                    onmouseout="this.style.background='rgba(15, 20, 25, 0.8)'"
                  >
                    ‚Üì
                  </button>
                  <button
                    (click)="removeLayer(idx); $event.stopPropagation()"
                    style="
                      padding: 0.5rem 0.75rem;
                      background: rgba(239, 68, 68, 0.1);
                      color: #ef4444;
                      border: 2px solid rgba(239, 68, 68, 0.3);
                      border-radius: 8px;
                      cursor: pointer;
                      font-size: 1.125rem;
                      transition: all 0.2s;
                    "
                    onmouseover="this.style.background='rgba(239, 68, 68, 0.2)'"
                    onmouseout="this.style.background='rgba(239, 68, 68, 0.1)'"
                  >
                    ‚úï
                  </button>
                </div>
              </div>
            </div>
            }
          </div>
          }
        </div>

        <!-- Layer Configuration Panel -->
        @if (selectedLayerIndex() !== null) {
        <div
          style="
            margin-top: 2rem;
            background: rgba(26, 31, 46, 0.8);
            padding: 1.5rem;
            border: 2px solid rgba(6, 182, 212, 0.5);
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(6, 182, 212, 0.2);
            backdrop-filter: blur(20px);
          "
        >
          <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem">
            <div
              style="
                width: 48px;
                height: 48px;
                border-radius: 12px;
                background: linear-gradient(135deg, #06b6d4, #d946ef);
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.5rem;
              "
            >
              ‚öôÔ∏è
            </div>
            <div>
              <h3 style="font-size: 1.5rem; font-weight: 700; color: white">Layer Configuration</h3>
              <p style="font-size: 0.875rem; color: #9ca3af">
                Customize layer {{ selectedLayerIndex()! + 1 }} parameters
              </p>
            </div>
          </div>
          <form
            [formGroup]="layerConfigForm"
            style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem"
          >
            <div style="grid-column: span 2">
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #d1d5db;
                  margin-bottom: 0.5rem;
                "
                >Layer Name</label
              >
              <input
                formControlName="name"
                style="
                  width: 100%;
                  padding: 0.75rem 1rem;
                  background: rgba(15, 20, 25, 0.8);
                  border: 2px solid #2d3548;
                  border-radius: 8px;
                  color: white;
                  font-weight: 500;
                  transition: all 0.2s;
                "
                onfocus="this.style.borderColor='#06b6d4'; this.style.background='rgba(6, 182, 212, 0.05)'"
                onblur="this.style.borderColor='#2d3548'; this.style.background='rgba(15, 20, 25, 0.8)'"
              />
            </div>

            @if (layers()[selectedLayerIndex()!].type === 'dense') {
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #d1d5db;
                  margin-bottom: 0.5rem;
                "
                >Units</label
              >
              <input
                type="number"
                formControlName="units"
                style="
                  width: 100%;
                  padding: 0.75rem 1rem;
                  background: rgba(15, 20, 25, 0.8);
                  border: 2px solid #2d3548;
                  border-radius: 8px;
                  color: white;
                  font-weight: 500;
                  transition: all 0.2s;
                "
                onfocus="this.style.borderColor='#06b6d4'; this.style.background='rgba(6, 182, 212, 0.05)'"
                onblur="this.style.borderColor='#2d3548'; this.style.background='rgba(15, 20, 25, 0.8)'"
              />
            </div>
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #d1d5db;
                  margin-bottom: 0.5rem;
                "
                >Activation</label
              >
              <select
                formControlName="activation"
                style="
                  width: 100%;
                  padding: 0.75rem 1rem;
                  background: rgba(15, 20, 25, 0.8);
                  border: 2px solid #2d3548;
                  border-radius: 8px;
                  color: white;
                  font-weight: 500;
                  transition: all 0.2s;
                  cursor: pointer;
                "
                onfocus="this.style.borderColor='#06b6d4'; this.style.background='rgba(6, 182, 212, 0.05)'"
                onblur="this.style.borderColor='#2d3548'; this.style.background='rgba(15, 20, 25, 0.8)'"
              >
                <option value="relu">ReLU</option>
                <option value="sigmoid">Sigmoid</option>
                <option value="tanh">Tanh</option>
                <option value="softmax">Softmax</option>
                <option value="linear">Linear</option>
              </select>
            </div>
            } @if (layers()[selectedLayerIndex()!].type === 'conv2d') {
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #d1d5db;
                  margin-bottom: 0.5rem;
                "
                >Filters</label
              >
              <input
                type="number"
                formControlName="filters"
                style="
                  width: 100%;
                  padding: 0.75rem 1rem;
                  background: rgba(15, 20, 25, 0.8);
                  border: 2px solid #2d3548;
                  border-radius: 8px;
                  color: white;
                  font-weight: 500;
                  transition: all 0.2s;
                "
                onfocus="this.style.borderColor='#06b6d4'; this.style.background='rgba(6, 182, 212, 0.05)'"
                onblur="this.style.borderColor='#2d3548'; this.style.background='rgba(15, 20, 25, 0.8)'"
              />
            </div>
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #d1d5db;
                  margin-bottom: 0.5rem;
                "
                >Kernel Size</label
              >
              <input
                type="number"
                formControlName="kernelSize"
                style="
                  width: 100%;
                  padding: 0.75rem 1rem;
                  background: rgba(15, 20, 25, 0.8);
                  border: 2px solid #2d3548;
                  border-radius: 8px;
                  color: white;
                  font-weight: 500;
                  transition: all 0.2s;
                "
                onfocus="this.style.borderColor='#06b6d4'; this.style.background='rgba(6, 182, 212, 0.05)'"
                onblur="this.style.borderColor='#2d3548'; this.style.background='rgba(15, 20, 25, 0.8)'"
              />
            </div>
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #d1d5db;
                  margin-bottom: 0.5rem;
                "
                >Activation</label
              >
              <select
                formControlName="activation"
                style="
                  width: 100%;
                  padding: 0.75rem 1rem;
                  background: rgba(15, 20, 25, 0.8);
                  border: 2px solid #2d3548;
                  border-radius: 8px;
                  color: white;
                  font-weight: 500;
                  transition: all 0.2s;
                  cursor: pointer;
                "
                onfocus="this.style.borderColor='#06b6d4'; this.style.background='rgba(6, 182, 212, 0.05)'"
                onblur="this.style.borderColor='#2d3548'; this.style.background='rgba(15, 20, 25, 0.8)'"
              >
                <option value="relu">ReLU</option>
                <option value="sigmoid">Sigmoid</option>
                <option value="tanh">Tanh</option>
              </select>
            </div>
            } @if (layers()[selectedLayerIndex()!].type === 'maxPooling2d') {
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #d1d5db;
                  margin-bottom: 0.5rem;
                "
                >Pool Size</label
              >
              <input
                type="number"
                formControlName="poolSize"
                style="
                  width: 100%;
                  padding: 0.75rem 1rem;
                  background: rgba(15, 20, 25, 0.8);
                  border: 2px solid #2d3548;
                  border-radius: 8px;
                  color: white;
                  font-weight: 500;
                  transition: all 0.2s;
                "
                onfocus="this.style.borderColor='#06b6d4'; this.style.background='rgba(6, 182, 212, 0.05)'"
                onblur="this.style.borderColor='#2d3548'; this.style.background='rgba(15, 20, 25, 0.8)'"
              />
            </div>
            } @if (layers()[selectedLayerIndex()!].type === 'dropout') {
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #d1d5db;
                  margin-bottom: 0.5rem;
                "
                >Dropout Rate</label
              >
              <input
                type="number"
                formControlName="rate"
                step="0.1"
                style="
                  width: 100%;
                  padding: 0.75rem 1rem;
                  background: rgba(15, 20, 25, 0.8);
                  border: 2px solid #2d3548;
                  border-radius: 8px;
                  color: white;
                  font-weight: 500;
                  transition: all 0.2s;
                "
                onfocus="this.style.borderColor='#06b6d4'; this.style.background='rgba(6, 182, 212, 0.05)'"
                onblur="this.style.borderColor='#2d3548'; this.style.background='rgba(15, 20, 25, 0.8)'"
              />
            </div>
            } @if (selectedLayerIndex() === 0) {
            <div style="grid-column: span 2">
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #d1d5db;
                  margin-bottom: 0.5rem;
                "
                >Input Shape (comma-separated)</label
              >
              <input
                formControlName="inputShape"
                placeholder="e.g., 28,28,1"
                style="
                  width: 100%;
                  padding: 0.75rem 1rem;
                  background: rgba(15, 20, 25, 0.8);
                  border: 2px solid #2d3548;
                  border-radius: 8px;
                  color: white;
                  font-weight: 500;
                  transition: all 0.2s;
                "
                onfocus="this.style.borderColor='#06b6d4'; this.style.background='rgba(6, 182, 212, 0.05)'"
                onblur="this.style.borderColor='#2d3548'; this.style.background='rgba(15, 20, 25, 0.8)'"
              />
            </div>
            }

            <div style="grid-column: span 2; margin-top: 0.5rem">
              <button
                (click)="updateSelectedLayer()"
                type="button"
                style="
                  width: 100%;
                  padding: 1rem 1.5rem;
                  background: linear-gradient(to right, #06b6d4, #3b82f6);
                  color: white;
                  border-radius: 12px;
                  font-weight: 700;
                  font-size: 1.125rem;
                  transition: all 0.3s;
                  border: none;
                  cursor: pointer;
                "
                onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 20px 25px -5px rgba(6, 182, 212, 0.4)'"
                onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'"
              >
                <span
                  style="display: flex; align-items: center; justify-content: center; gap: 0.5rem"
                >
                  <span>‚úì</span>
                  <span>Update Layer</span>
                </span>
              </button>
            </div>
          </form>
        </div>
        }

        <!-- Build Button -->
        <div style="margin-top: 2rem">
          @if (isValid()) {
          <div
            style="
              margin-bottom: 1rem;
              padding: 1.25rem;
              background: linear-gradient(
                to right,
                rgba(16, 185, 129, 0.1),
                rgba(6, 182, 212, 0.1)
              );
              border: 2px solid rgba(16, 185, 129, 0.3);
              border-radius: 12px;
            "
          >
            <p
              style="
                color: #10b981;
                text-align: center;
                font-weight: 700;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
              "
            >
              <span style="font-size: 1.5rem">‚úÖ</span>
              <span>Network is ready! Click below to compile your model</span>
            </p>
          </div>
          }
          <button
            (click)="buildModel()"
            [disabled]="!isValid()"
            [style.opacity]="!isValid() ? '0.4' : '1'"
            [style.cursor]="!isValid() ? 'not-allowed' : 'pointer'"
            style="
              width: 100%;
              padding: 1.5rem 2rem;
              background: linear-gradient(to right, #06b6d4, #3b82f6, #a855f7);
              color: white;
              border-radius: 16px;
              font-weight: 700;
              font-size: 1.5rem;
              transition: all 0.3s;
              border: none;
            "
            onmouseover="if(!this.disabled) this.style.transform='scale(1.05)'; if(!this.disabled) this.style.boxShadow='0 25px 50px -12px rgba(6, 182, 212, 0.5)'"
            onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'"
          >
            <span style="display: flex; align-items: center; justify-content: center; gap: 0.75rem">
              <span style="font-size: 2rem">üöÄ</span>
              <span>Build Neural Network</span>
            </span>
          </button>
          @if (!isValid()) {
          <div
            style="
              margin-top: 1rem;
              padding: 1.25rem;
              background: rgba(239, 68, 68, 0.1);
              border: 2px solid rgba(239, 68, 68, 0.3);
              border-radius: 12px;
            "
          >
            <p style="color: #ef4444; text-align: center; font-weight: 500">
              <span style="font-size: 1.5rem; margin-right: 0.5rem">‚ö†Ô∏è</span>
              <strong>Requirements:</strong> Add at least one layer with an input shape
            </p>
          </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>
